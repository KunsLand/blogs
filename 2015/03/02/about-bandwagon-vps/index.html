<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>关于搬瓦工(BandwagonHost)VPS | Kevin Lee</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="Kevin Lee">
  
  
    <meta name="description" content="之前一直使用fqrouter2翻墙与Google Play结合使用更新Nexus 5上的应用，直到新年之处（2015年1月中旬）发现fqrouter2不那么好使了，每次打开Google Play，能看到一大堆应用升级提示，但就是下载不了。偶然点进fqrouter2“帮助”（或是“关于”，具体记不清了）里的测试组链接，这个测试组是建在Google Plus上的，里面有大量关于fqrouter2的测试">
  
  <meta name="description" content="之前一直使用fqrouter2翻墙与Google Play结合使用更新Nexus 5上的应用，直到新年之处（2015年1月中旬）发现fqrouter2不那么好使了，每次打开Google Play，能看到一大堆应用升级提示，但就是下载不了。偶然点进fqrouter2“帮助”（或是“关于”，具体记不清了）里的测试组链接，这个测试组是建在Google Plus上的，里面有大量关于fqrouter2的测试">
<meta property="og:type" content="article">
<meta property="og:title" content="关于搬瓦工(BandwagonHost)VPS">
<meta property="og:url" content="http://kunsland.github.io/blogs/2015/03/02/about-bandwagon-vps/index.html">
<meta property="og:site_name" content="Kevin Lee">
<meta property="og:description" content="之前一直使用fqrouter2翻墙与Google Play结合使用更新Nexus 5上的应用，直到新年之处（2015年1月中旬）发现fqrouter2不那么好使了，每次打开Google Play，能看到一大堆应用升级提示，但就是下载不了。偶然点进fqrouter2“帮助”（或是“关于”，具体记不清了）里的测试组链接，这个测试组是建在Google Plus上的，里面有大量关于fqrouter2的测试">
<meta property="og:updated_time" content="2015-12-04T04:21:49.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于搬瓦工(BandwagonHost)VPS">
<meta name="twitter:description" content="之前一直使用fqrouter2翻墙与Google Play结合使用更新Nexus 5上的应用，直到新年之处（2015年1月中旬）发现fqrouter2不那么好使了，每次打开Google Play，能看到一大堆应用升级提示，但就是下载不了。偶然点进fqrouter2“帮助”（或是“关于”，具体记不清了）里的测试组链接，这个测试组是建在Google Plus上的，里面有大量关于fqrouter2的测试">
  
  
    <link rel="icon" type="image/x-icon" href="/blogs/favicon.ico">
  
  <link rel="stylesheet" href="/blogs/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/blogs/">Kevin Lee</a></h1>
    <p><a href="/blogs/">Everything in the world is mutual connected.</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/blogs">Home</a></li>
      
        <li><a href="/blogs/archives">Archives</a></li>
      
        <li><a href="/">About</a></li>
      
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/blogs/2015/03/02/about-bandwagon-vps/">
  <time datetime="2015-03-02T07:18:56.000Z">
    Mar 2 2015
  </time>
</a>
    
    
  
    <h1 class="title">关于搬瓦工(BandwagonHost)VPS</h1>
  

  </header>
  
  <div class="entry">
    
      <p>之前一直使用fqrouter2翻墙与Google Play结合使用更新Nexus 5上的应用，直到新年之处（2015年1月中旬）发现fqrouter2不那么好使了，每次打开Google Play，能看到一大堆应用升级提示，但就是下载不了。偶然点进fqrouter2“帮助”（或是“关于”，具体记不清了）里的测试组链接，这个测试组是建在Google Plus上的，里面有大量关于fqrouter2的测试讨论，以及大量的关于翻墙手段的讨论。于是发现了一个名叫Anonymous V的牛人写的<a href="https://plus.google.com/103234343779069345365/posts/MLy82ud6wjY" target="_blank" rel="external">使用Shadowsocks翻墙的教程</a>。作者对VPS提供商的比较与选择、Shadowsocks的安装和配置这两大方面进行了详细的说明和指导。最终我结合自己的需求和财力，购买了搬瓦工VPS，搭建了ShadowSocks服务器（简称ss）。今天又花了一点时间弄PC端和手机端的配置，让SS同时支持IPV4和IPV6，速度一般，但已经满足我的需求了。</p>
<a id="more"></a>
<h3 id="为什么选择搬瓦工？">为什么选择搬瓦工？</h3><p><strong>便宜</strong>。我选的是Anonymous V提供的4.99美元一年的<a href="https://bandwagonhost.com/aff.php?aff=1285&amp;pid=20" target="_blank" rel="external">套餐</a>，HDD: 2.0 GB, RAM: 96 MB, CPU: 1x Intel Xeon, 流量: 200 GB/月，物理地址在西海岸洛杉矶（LA）。</p>
<h3 id="有了VPS能做些什么？">有了VPS能做些什么？</h3><ul>
<li>手机、电脑翻墙，同时支持IPV4/IPV6</li>
<li>使用Google Play给手机更新APP</li>
<li>通过建立IPV6代理，减少校园网收费所带来的费用</li>
</ul>
<h3 id="选择何种方式支付？">选择何种方式支付？</h3><p>选择Paypal支付是最通用的方式，因此最好注册一个<a href="https://www.paypal.com/c2/webapps/mpp/home" target="_blank" rel="external">Paypal账号</a>，往里面充值或绑定银行卡/借记卡。<br>方式一：注册一个Paypal账号，绑定银行卡（我的Paypal-&gt;用户信息-&gt;财务信息-&gt;银行账户-&gt;添加我的银行），购买VPS时选择Paypal支付即可。<br>方式二：对于那些不放心直接将银行卡绑定到Paypal的，可以到<a href="http://www.globalcash.hk/" target="_blank" rel="external">全球付</a>注册一个帐号，可以用国内通用的支付方式（支付宝、网银等）买一张虚拟借记卡（MasterCard），这张虚拟卡同样也可绑定到Paypal（我的Paypal-&gt;用户信息-&gt;财务信息-&gt;借记卡和信用卡），再用Paypal支付即可。</p>
<h3 id="配置ShadowSocks">配置ShadowSocks</h3><p>参见Anonymous V写的<a href="https://plus.google.com/103234343779069345365/posts/Xce4EJpLGhX" target="_blank" rel="external">教程</a>。翻不了墙看我的简短版：</p>
<ul>
<li>下载<a href="http://www.putty.org" target="_blank" rel="external">putty</a>，远程登录到VPS，搬瓦工的密码：My Services-&gt;KiviVM Control Panel-&gt;Root password modification-&gt;Generate xxxx。</li>
<li><p>安装必备部件，需要选择的时候，输入y回车：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release&#10;yum update&#10;yum install python-setuptools m2crypto supervisor&#10;easy_install pip&#10;pip install shadowsocks</span><br></pre></td></tr></table></figure>
</li>
<li><p>在VPS上配置ShadowSocks服务器端，输入<code>vi /etc/shadowsocks.json</code>命令，按i进入编辑模式，输入或粘贴（Putty里单击右键为粘贴）如下内容（其中password是由你指定的任意密码，用来连接ShadowSocks）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#10;    &#34;server&#34;:&#34;0.0.0.0&#34;,&#10;    &#34;server_port&#34;:8388,&#10;    &#34;local_port&#34;:1080,&#10;    &#34;password&#34;:&#34;xxxxx&#34;,&#10;    &#34;timeout&#34;:600,&#10;    &#34;method&#34;:&#34;aes-256-cfb&#34;&#10;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑好后，按ESC退出编辑模式，再按<code>SHIFT zz</code>（一个Shift键加两次z键）保存并退出文件编辑。</p>
</li>
<li><p>执行命令<code>vi /etc/supervisord.conf</code>，按i进入编辑模式，输入或粘贴如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[program:shadowsocks]&#10;command=ssserver -c /etc/shadowsocks.json&#10;autostart=true&#10;autorestart=true&#10;user=root&#10;log_stderr=true&#10;logfile=/var/log/shadowsocks.log</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑好后，按ESC退出编辑模式，再按<code>SHIFT zz</code>（一个Shift键加两次z键）保存并退出文件编辑。</p>
</li>
<li><p>执行命令<code>vi /etc/rc.local</code>，按i进入编辑模式，文件末尾输入或粘贴如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service supervisord start</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑好后，按ESC退出编辑模式，再按<code>SHIFT zz</code>（一个Shift键加两次z键）保存并退出文件编辑。</p>
</li>
<li>执行<code>reboot</code>命令，Putty会提示连接断开，隔几秒后可根据需要重连。<br>至此，ShadowSocks服务器端配置完毕，PC客户端可以下载<a href="http://sourceforge.net/projects/shadowsocksgui/files/dist/" target="_blank" rel="external">shadowsocks-gui</a>，智能手机客户端各大应用商城搜索ShadowSocks（又叫“影梭”），输入你的VPS IP地址和ShadowSocks密码即可，加密方式选aes-256-cfb。</li>
</ul>
<h3 id="给搬瓦工添加IPV6支持">给搬瓦工添加IPV6支持</h3><p>搬瓦工不直接支持IPV6访问，参考网上搜到<strong>CHON</strong>的一篇<a href="http://ichon.me/post/659.html" target="_blank" rel="external">博客</a>，我给自己的搬瓦工VPS（刚好就是OpenVZ架构）添加了IPV6支持。</p>
<p>一般情况下，只需要在<a href="https://tunnelbroker.net/" target="_blank" rel="external">HE Free IPv6 Tunnel Broker</a>（简称<strong>HETB</strong>）注册一个帐号，登录之后用VPS的IPV4地址Create Regular Tunnel（地点选VPS的物理地址，我的是LA），然后根据Example Configurations的指导配置VPS即可。</p>
<p>但是搬瓦工的默认操作系统为centos 6，Example Configurations里面没有centos的配置指导，所以得进行如下操作：</p>
<ul>
<li><p>检测tun/tap设备，运行如下命令，看是否返回<code>File Descriptor in bad state</code>，如果是则继续，不是则我也不知道该怎么弄（应该不会发生后面这种情况）。这里跟<strong>CHON</strong>博客中的一样。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /dev/net/tun</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果系统没有gcc（一般都没有gcc），需要安装gcc，这是<strong>CHON</strong>没提到的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall &#34;Development Tools&#34;</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载并编译tb-tun，跟<strong>CHON</strong>博客中的一样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://tb-tun.googlecode.com/files/tb-tun_r18.tar.gz&#10;tar xvf tb-tun_r18.tar.gz&#10;gcc tb_userspace.c -l pthread -o tb_userspace</span><br></pre></td></tr></table></figure>
</li>
<li><p>给VPS添加IPV6隧道，跟<strong>CHON</strong>博客中的略有区别，最后一句是根据<strong>CHON</strong>的这篇博文下面的讨论提取出来的。如果卡在第一条命令，按回车可以继续进行后面操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setsid ./tb_userspace tb 5.6.7.8 1.2.3.4 sit&#10;ifconfig tb up&#10;ifconfig tb inet6 add 2001:a:b:c::2/64&#10;ifconfig tb mtu 1480&#10;route -A inet6 add ::/0 dev tb&#10;ip -6 route del default dev venet0</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行<code>ping6 he.net</code>，看是否超时，如果超时则配置不成功；如果不断返回数据报响应延迟数据报告，则配置成功。按<code>Control + C</code>终止命令。</p>
</li>
<li><p><strong>开机自动添加IPV6隧道脚本</strong>，这里的脚本是根据<strong>CHON</strong>博文下面的讨论内容和自己的实践总结出来的。用<code>vi /etc/rc.local</code>命令在/etc/rc.local文件中添加如下内容。<strong>注意第一行的区别</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/root/tb_userspace tb 5.6.7.8 1.2.3.4 sit &#38;&#10;ifconfig tb up&#10;ifconfig tb inet6 add 2001:a:b:c::2/64&#10;ifconfig tb mtu 1480&#10;route -A inet6 add ::/0 dev tb&#10;ip -6 route del default dev venet0&#10;ifconfig tb up</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置VPS的ShadowSocks服务器端，将<code>/etc/shadowsocks.json</code>文件中的server对应的ip地址换成<code>::</code>，表示任意IP协议的任意地址。</p>
</li>
<li>配置ShadowSocks的客户端，将服务器 ip换成2001:a:b:c::2即可，其他不变。</li>
<li>注意以上IP地址要换成自己的IPV6 Tunnel Endpoints地址（<a href="https://tunnelbroker.net/" target="_blank" rel="external">HETB</a>-&gt;Main Page-&gt;[xxxx.ipv6.he.net]-&gt;），5.6.7.8为Server IPv4地址，1.2.3.4为Client IPv4地址（即VPS地址），2001:a:b:c::2/64为Client IPV6地址。</li>
</ul>
<h3 id="关于ShadowSocks全局代理">关于ShadowSocks全局代理</h3><p>在勾选全局代理后，PC端的应用大都不会（IE浏览器除外）自动使用代理上网。以QQ为例，需要在登录时设置代理。也可以在网上搜索全局代理的解决方法，我试过Proxifier，感觉速度有影响。</p>
<h3 id="让Windows系统更新也走代理">让Windows系统更新也走代理</h3><p>Windows系统下“全局代理”并不是真正的全局代理，系统更新(Windows Update)并没走SS代理。需要以<strong>管理员身份</strong>执行以下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh winhttp set proxy localhost:1080 &#34;&#60;local&#62;&#34;</span><br></pre></td></tr></table></figure></p>
<p>如果不想用代理了，记得重置winhttp：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh winhttp reset proxy</span><br></pre></td></tr></table></figure></p>

    
  </div>
  <footer>
    
      
      
  <div class="tags">
    <a class="tags-link" href="/blogs/tags/bandwagon/">bandwagon</a>, <a class="tags-link" href="/blogs/tags/gfw/">gfw</a>, <a class="tags-link" href="/blogs/tags/ipv6/">ipv6</a>, <a class="tags-link" href="/blogs/tags/vps/">vps</a>
  </div>

    
    <div class="clearfix"></div>
  </footer>
</article>


<section id="comment">
  <h1 class="title">评论</h1>
  <div class="ds-thread" data-title="关于搬瓦工(BandwagonHost)VPS">
  </div>
</section>
</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2015 <a href="http://kunsland.github.io">Kevin Lee</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://kunsland.github.io" target="_blank">Kevin Lee</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/blogs/js/scale.fix.js"></script>
<script src="/blogs/js/jquery.imagesloaded.min.js"></script>
<script src="/blogs/js/gallery.js"></script>


<script type="text/javascript">
  var duoshuoQuery = { short_name: 'kevinlee' };
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>



<link rel="stylesheet" href="/blogs/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/blogs/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>